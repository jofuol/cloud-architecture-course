<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This site contains Google Cloud Platform documentation with most used commands"><meta name=author content="Jose Luis Furió Oliver"><link href=https://www.jofuol.com/network-load-balancers/ rel=canonical><link rel=prev href=..><link rel=icon href=../assets/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.0"><title>network-load-balancers - Google Cloud Architect Documentation</title><link rel=stylesheet href=../assets/stylesheets/main.618322db.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link rel=stylesheet href=../assets/stylesheets/custom.a2a27114.min.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#set-up-network-load-balancers-link class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> For updates follow <strong>@squidfunk</strong> on <a rel=me href=https://fosstodon.org/@squidfunk> <span class="twemoji mastodon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M433 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.6-28.4-290.5 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.6-.9-9.3-.9-13.9 85.6 20.9 158.7 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5H201V197c0-58.5-64-56.6-64-6.9v114.2H90.3c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175"/></svg> </span> <strong>Fosstodon</strong> </a> and <a href=https://x.com/squidfunk> <span class="twemoji twitter"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg> </span> <strong>Twitter</strong> </a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Google Cloud Architect Documentation" class="md-header__button md-logo" aria-label="Google Cloud Architect Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Google Cloud Architect Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> network-load-balancers </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/squidfunk/mkdocs-material title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> squidfunk/mkdocs-material </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> network-load-balancers </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Google Cloud Architect Documentation" class="md-nav__button md-logo" aria-label="Google Cloud Architect Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> Google Cloud Architect Documentation </label> <div class=md-nav__source> <a href=https://github.com/squidfunk/mkdocs-material title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> squidfunk/mkdocs-material </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> network-load-balancers </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> network-load-balancers </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> <nav class=md-nav aria-label=Overview> <ul class=md-nav__list> <li class=md-nav__item> <a href=#objectives class=md-nav__link> <span class=md-ellipsis> Objectives </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#setup-and-requirements class=md-nav__link> <span class=md-ellipsis> Setup and requirements </span> </a> <nav class=md-nav aria-label="Setup and requirements"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#before-you-click-the-start-lab-button class=md-nav__link> <span class=md-ellipsis> Before you click the Start Lab button </span> </a> </li> <li class=md-nav__item> <a href=#how-to-start-your-lab-and-sign-in-to-the-google-cloud-console class=md-nav__link> <span class=md-ellipsis> How to start your lab and sign in to the Google Cloud console </span> </a> </li> <li class=md-nav__item> <a href=#activate-cloud-shell class=md-nav__link> <span class=md-ellipsis> Activate Cloud Shell </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#task-1-set-the-default-region-and-zone-for-all-resources class=md-nav__link> <span class=md-ellipsis> Task 1. Set the default region and zone for all resources </span> </a> </li> <li class=md-nav__item> <a href=#task-2-create-multiple-web-server-instances class=md-nav__link> <span class=md-ellipsis> Task 2. Create multiple web server instances </span> </a> </li> <li class=md-nav__item> <a href=#task-3-configure-the-load-balancing-service class=md-nav__link> <span class=md-ellipsis> Task 3. Configure the load balancing service </span> </a> </li> <li class=md-nav__item> <a href=#task-4-create-the-target-pool-and-forwarding-rule class=md-nav__link> <span class=md-ellipsis> Task 4. Create the target pool and forwarding rule </span> </a> </li> <li class=md-nav__item> <a href=#task-5-send-traffic-to-your-instances class=md-nav__link> <span class=md-ellipsis> Task 5. Send traffic to your instances </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> <nav class=md-nav aria-label=Overview> <ul class=md-nav__list> <li class=md-nav__item> <a href=#objectives class=md-nav__link> <span class=md-ellipsis> Objectives </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#setup-and-requirements class=md-nav__link> <span class=md-ellipsis> Setup and requirements </span> </a> <nav class=md-nav aria-label="Setup and requirements"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#before-you-click-the-start-lab-button class=md-nav__link> <span class=md-ellipsis> Before you click the Start Lab button </span> </a> </li> <li class=md-nav__item> <a href=#how-to-start-your-lab-and-sign-in-to-the-google-cloud-console class=md-nav__link> <span class=md-ellipsis> How to start your lab and sign in to the Google Cloud console </span> </a> </li> <li class=md-nav__item> <a href=#activate-cloud-shell class=md-nav__link> <span class=md-ellipsis> Activate Cloud Shell </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#task-1-set-the-default-region-and-zone-for-all-resources class=md-nav__link> <span class=md-ellipsis> Task 1. Set the default region and zone for all resources </span> </a> </li> <li class=md-nav__item> <a href=#task-2-create-multiple-web-server-instances class=md-nav__link> <span class=md-ellipsis> Task 2. Create multiple web server instances </span> </a> </li> <li class=md-nav__item> <a href=#task-3-configure-the-load-balancing-service class=md-nav__link> <span class=md-ellipsis> Task 3. Configure the load balancing service </span> </a> </li> <li class=md-nav__item> <a href=#task-4-create-the-target-pool-and-forwarding-rule class=md-nav__link> <span class=md-ellipsis> Task 4. Create the target pool and forwarding rule </span> </a> </li> <li class=md-nav__item> <a href=#task-5-send-traffic-to-your-instances class=md-nav__link> <span class=md-ellipsis> Task 5. Send traffic to your instances </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/squidfunk/mkdocs-material/edit/master/docs/network-load-balancers/index.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/squidfunk/mkdocs-material/raw/master/docs/network-load-balancers/index.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=set-up-network-load-balancers-link>Set Up Network Load Balancers <a href=https://www.skills.google/paths/12/course_templates/648/labs/597916>Link</a><a class=headerlink href=#set-up-network-load-balancers-link title="Permanent link">&para;</a></h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>In this hands-on lab you learn how to set up a passthrough network load balancer (NLB) running on Compute Engine virtual machines (VMs). A Layer 4 (L4) NLB handles traffic based on network-level information like IP addresses and port numbers, and does not inspect the content of the traffic.</p> <p>There are several ways you can <a href=https://cloud.google.com/load-balancing/docs/load-balancing-overview#a_closer_look_at_cloud_load_balancers>load balance on Google Cloud</a>. This lab takes you through the setup of the following load balancers:</p> <ul> <li><a href=https://cloud.google.com/compute/docs/load-balancing/network/ >Network Load Balancer</a></li> </ul> <p>You are encouraged to type the commands yourself, which can help you learn the core concepts. Many labs include a code block that contains the required commands. You can easily copy and paste the commands from the code block into the appropriate places during the lab.</p> <h3 id=objectives>Objectives<a class=headerlink href=#objectives title="Permanent link">&para;</a></h3> <p>In this lab, you learn how to perform the following tasks:</p> <ul> <li>Configure the default region and zone for your resources.</li> <li>Create multiple web server instances.</li> <li>Configure a load balancing service.</li> <li>Configure a forwarding rule to distribute traffic</li> </ul> <h2 id=setup-and-requirements>Setup and requirements<a class=headerlink href=#setup-and-requirements title="Permanent link">&para;</a></h2> <h3 id=before-you-click-the-start-lab-button>Before you click the Start Lab button<a class=headerlink href=#before-you-click-the-start-lab-button title="Permanent link">&para;</a></h3> <p>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click Start Lab, shows how long Google Cloud resources are made available to you.</p> <p>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</p> <p>To complete this lab, you need:</p> <ul> <li>Access to a standard internet browser (Chrome browser recommended).</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Note: Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</p> </div> <ul> <li>Time to complete the lab—remember, once you start, you cannot pause a lab.</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Note: Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</p> </div> <h3 id=how-to-start-your-lab-and-sign-in-to-the-google-cloud-console>How to start your lab and sign in to the Google Cloud console<a class=headerlink href=#how-to-start-your-lab-and-sign-in-to-the-google-cloud-console title="Permanent link">&para;</a></h3> <ol> <li> <p>Click the Start Lab button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</p> </li> <li> <p>The Open Google Cloud console button</p> </li> <li>Time remaining</li> <li>The temporary credentials that you must use for this lab</li> <li> <p>Other information, if needed, to step through this lab</p> </li> <li> <p>Click Open Google Cloud console (or right-click and select Open Link in Incognito Window if you are running the Chrome browser).</p> </li> </ol> <p>The lab spins up resources, and then opens another tab that shows the Sign in page.</p> <p><strong>Tip:</strong> Arrange the tabs in separate windows, side-by-side.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Note: If you see the Choose an account dialog, click Use Another Account.</p> </div> <ol> <li>If necessary, copy the Username below and paste it into the Sign in dialog.</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=s2>&quot;Username&quot;</span>
</span></code></pre></div> <p>You can also find the Username in the Lab Details pane.</p> <ol> <li> <p>Click Next.</p> </li> <li> <p>Copy the Password below and paste it into the Welcome dialog.</p> </li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=s2>&quot;Password&quot;</span>
</span></code></pre></div> <p>You can also find the Password in the Lab Details pane.</p> <ol> <li>Click Next.</li> </ol> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Important: You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</p> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Note: Using your own Google Cloud account for this lab may incur extra charges.</p> </div> <ol> <li> <p>Click through the subsequent pages:</p> </li> <li> <p>Accept the terms and conditions.</p> </li> <li>Do not add recovery options or two-factor authentication (because this is a temporary account).</li> <li>Do not sign up for free trials.</li> </ol> <p>After a few moments, the Google Cloud console opens in this tab.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Note: To access Google Cloud products and services, click the Navigation menu or type the service or product name in the Search field. Navigation menu icon and Search field <img alt=gcp-search.png src=../images/network-load-balancers/gcp-search.png></p> </div> <h3 id=activate-cloud-shell>Activate Cloud Shell<a class=headerlink href=#activate-cloud-shell title="Permanent link">&para;</a></h3> <p>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</p> <ol> <li> <p>Click Activate Cloud Shell <strong>Activate Cloud Shell</strong> <img alt=shell-icon.png src=../images/network-load-balancers/shell-icon.png> at the top of the Google Cloud console.</p> </li> <li> <p>Click through the following windows:</p> </li> <li> <p>Continue through the Cloud Shell information window.</p> </li> <li>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</li> </ol> <p>When you are connected, you are already authenticated, and the project is set to your <strong>Project_ID</strong>, <code>PROJECT_ID</code>. The output contains a line that declares the <strong>Project_ID</strong> for this session:</p> <div class="language-shell highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>Your<span class=w> </span>Cloud<span class=w> </span>Platform<span class=w> </span>project<span class=w> </span><span class=k>in</span><span class=w> </span>this<span class=w> </span>session<span class=w> </span>is<span class=w> </span><span class=nb>set</span><span class=w> </span>to<span class=w> </span><span class=s2>&quot;PROJECT_ID&quot;</span>
</span></code></pre></div> <p>'gcloud' is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</p> <ol> <li>(Optional) You can list the active account name with this command:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>gcloud<span class=w> </span>auth<span class=w> </span>list
</span></code></pre></div> <ol> <li>Click <strong>Authorize</strong>.</li> </ol> <p><strong>Output:</strong></p> <div class="language-shell highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>ACTIVE:<span class=w> </span>*
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>ACCOUNT:<span class=w> </span><span class=s2>&quot;ACCOUNT&quot;</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>To<span class=w> </span><span class=nb>set</span><span class=w> </span>the<span class=w> </span>active<span class=w> </span>account,<span class=w> </span>run:
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>$<span class=w> </span>gcloud<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>account<span class=w> </span><span class=sb>`</span>ACCOUNT<span class=sb>`</span>
</span></code></pre></div> <ol> <li>(Optional) You can list the project ID with this command:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>gcloud<span class=w> </span>config<span class=w> </span>list<span class=w> </span>project
</span></code></pre></div> <p><strong>Output</strong>:</p> <div class="language-shell highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=o>[</span>core<span class=o>]</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nv>project</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;PROJECT_ID&quot;</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Note: For full documentation of <code>gcloud</code>, in Google Cloud, refer to [the gcloud CLI overview guide][gcloud-cli-overview-guide].</p> </div> <h2 id=task-1-set-the-default-region-and-zone-for-all-resources>Task 1. Set the default region and zone for all resources<a class=headerlink href=#task-1-set-the-default-region-and-zone-for-all-resources title="Permanent link">&para;</a></h2> <ol> <li>Set the default region:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>gcloud<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>compute/region<span class=w> </span>Region
</span></code></pre></div> <ol> <li>In Cloud Shell, set the default zone:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>gcloud<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>compute/zone<span class=w> </span>Zone
</span></code></pre></div> <p>Learn more about choosing zones and regions in Compute Engine's [Regions and zones documentation][gcp-regions-zones-doc].</p> <h2 id=task-2-create-multiple-web-server-instances>Task 2. Create multiple web server instances<a class=headerlink href=#task-2-create-multiple-web-server-instances title="Permanent link">&para;</a></h2> <p>For this load balancing scenario, you create three Compute Engine VM instances and install Apache on them, then add a firewall rule that allows HTTP traffic to reach the instances.</p> <p>The code provided sets the zone to <code>Zone</code>. Setting the tags field lets you reference these instances all at once, such as with a firewall rule. These commands also install Apache on each instance and give each instance a unique home page.</p> <ol> <li>Create a virtual machine,<code>www1</code>, in your default zone using the following code:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>gcloud<span class=w> </span>compute<span class=w> </span>instances<span class=w> </span>create<span class=w> </span>www1<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>--zone<span class=o>=</span>Zone<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>--tags<span class=o>=</span>network-lb-tag<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>--machine-type<span class=o>=</span>e2-small<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>--image-family<span class=o>=</span>debian-11<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>--image-project<span class=o>=</span>debian-cloud<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>--metadata<span class=o>=</span>startup-script<span class=o>=</span><span class=s1>&#39;#!/bin/bash</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=s1>apt-get update</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=s1>apt-get install apache2 -y</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=s1>service apache2 restart</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=s1>echo &quot;</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=s1>&lt;h3&gt;Web Server: www1&lt;/h3&gt;&quot; | tee /var/www/html/index.html&#39;</span>
</span></code></pre></div> <ol> <li>Create a virtual machine, <code>www2</code>, in your default zone using the following code:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>gcloud<span class=w> </span>compute<span class=w> </span>instances<span class=w> </span>create<span class=w> </span>www2<span class=w> </span><span class=se>\</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>--zone<span class=o>=</span>Zone<span class=w> </span><span class=se>\</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>--tags<span class=o>=</span>network-lb-tag<span class=w> </span><span class=se>\</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>--machine-type<span class=o>=</span>e2-small<span class=w> </span><span class=se>\</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>--image-family<span class=o>=</span>debian-11<span class=w> </span><span class=se>\</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>--image-project<span class=o>=</span>debian-cloud<span class=w> </span><span class=se>\</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>--metadata<span class=o>=</span>startup-script<span class=o>=</span><span class=s1>&#39;#!/bin/bash</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=s1>apt-get update</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=s1>apt-get install apache2 -y</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=s1>service apache2 restart</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=s1>echo &quot;</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=s1>&lt;h3&gt;Web Server: www2&lt;/h3&gt;&quot; | tee /var/www/html/index.html&#39;</span>
</span></code></pre></div> <ol> <li>Create a virtual machine, <code>www3</code>, in your default zone.</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>gcloud<span class=w> </span>compute<span class=w> </span>instances<span class=w> </span>create<span class=w> </span>www3<span class=w> </span><span class=se>\</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>--zone<span class=o>=</span>Zone<span class=w>  </span><span class=se>\</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>--tags<span class=o>=</span>network-lb-tag<span class=w> </span><span class=se>\</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>--machine-type<span class=o>=</span>e2-small<span class=w> </span><span class=se>\</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>--image-family<span class=o>=</span>debian-11<span class=w> </span><span class=se>\</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>--image-project<span class=o>=</span>debian-cloud<span class=w> </span><span class=se>\</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>--metadata<span class=o>=</span>startup-script<span class=o>=</span><span class=s1>&#39;#!/bin/bash</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=s1>apt-get update</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=s1>apt-get install apache2 -y</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=s1>service apache2 restart</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=s1>echo &quot;</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=s1>&lt;h3&gt;Web Server: www3&lt;/h3&gt;&quot; | tee /var/www/html/index.html&#39;</span>
</span></code></pre></div> <ol> <li>Create a firewall rule to allow external traffic to the VM instances:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>gcloud<span class=w> </span>compute<span class=w> </span>firewall-rules<span class=w> </span>create<span class=w> </span>www-firewall-network-lb<span class=w> </span><span class=se>\</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>--target-tags<span class=w> </span>network-lb-tag<span class=w> </span>--allow<span class=w> </span>tcp:80
</span></code></pre></div> <p>Now you need to get the external IP addresses of your instances and verify that they are running.</p> <ol> <li>Run the following to list your instances. You'll see their IP addresses in the 'EXTERNAL_IP' column:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>gcloud<span class=w> </span>compute<span class=w> </span>instances<span class=w> </span>list
</span></code></pre></div> <ol> <li>Verify that each instance is running with curl, replacing <strong>[IP_ADDRESS]</strong> with the external IP address for each of your VMs:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>curl<span class=w> </span>http://<span class=o>[</span>IP_ADDRESS<span class=o>]</span>
</span></code></pre></div> <p><strong>Check my progress to verify that you've created a group of web servers.</strong> <strong>Create multiple web server instances</strong></p> <h2 id=task-3-configure-the-load-balancing-service>Task 3. Configure the load balancing service<a class=headerlink href=#task-3-configure-the-load-balancing-service title="Permanent link">&para;</a></h2> <p>When you configure the load balancing service, your virtual machine instances receives packets that are destined for the static external IP address you configure. Instances made with a Compute Engine image are automatically configured to handle this IP address.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Note: Learn more about how to set up Network Load Balancing from the [Backend service-based external passthrough Network Load Balancer overview][gcp-backend-service-based-external-passthrough-network-load-balancer-overview] guide.</p> </div> <ol> <li>Create a static external IP address for your load balancer:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>gcloud<span class=w> </span>compute<span class=w> </span>addresses<span class=w> </span>create<span class=w> </span>network-lb-ip-1<span class=w> </span><span class=se>\</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>--region<span class=w> </span>Region
</span></code></pre></div> <p><strong>Output</strong>:</p> <div class="language-shell highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>Created<span class=w> </span><span class=o>[</span>https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-03-xxxxxxxxxxx/regions//addresses/network-lb-ip-1<span class=o>]</span>.
</span></code></pre></div> <ol> <li>Add a legacy HTTP health check resource:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>gcloud<span class=w> </span>compute<span class=w> </span>http-health-checks<span class=w> </span>create<span class=w> </span>basic-check
</span></code></pre></div> <p><strong>Check my progress to verify that you've created an L4 Network Load Balancer that points to the web servers.</strong> <strong>Configure the load balancing service</strong></p> <h2 id=task-4-create-the-target-pool-and-forwarding-rule>Task 4. Create the target pool and forwarding rule<a class=headerlink href=#task-4-create-the-target-pool-and-forwarding-rule title="Permanent link">&para;</a></h2> <p>A target pool is a group of backend instances that receive incoming traffic from external passthrough NLBs. All backend instances of a target pool must reside in the same Google Cloud region.</p> <ol> <li>Run the following to create the target pool and use the health check, which is required for the service to function:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>gcloud<span class=w> </span>compute<span class=w> </span>target-pools<span class=w> </span>create<span class=w> </span>www-pool<span class=w> </span><span class=se>\</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>--region<span class=w> </span>Region<span class=w> </span>--http-health-check<span class=w> </span>basic-check
</span></code></pre></div> <ol> <li>Add the instances you created earlier to the pool:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>gcloud<span class=w> </span>compute<span class=w> </span>target-pools<span class=w> </span>add-instances<span class=w> </span>www-pool<span class=w> </span><span class=se>\</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>--instances<span class=w> </span>www1,www2,www3
</span></code></pre></div> <p>Next you'll make the [forwarding rule][gcp-forwarding-rule]. A forwarding rule specifies how to route network traffic to the backend services of a load balancer.</p> <ol> <li>Add a forwarding rule:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>gcloud<span class=w> </span>compute<span class=w> </span>forwarding-rules<span class=w> </span>create<span class=w> </span>www-rule<span class=w> </span><span class=se>\</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>--region<span class=w>  </span>Region<span class=w> </span><span class=se>\</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>--ports<span class=w> </span><span class=m>80</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>--address<span class=w> </span>network-lb-ip-1<span class=w> </span><span class=se>\</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>--target-pool<span class=w> </span>www-pool
</span></code></pre></div> <p><strong>Click Check my progress to verify that you've created the target pool and a forwarding rule.</strong> <strong>Create the target pool and forwarding rule</strong></p> <h2 id=task-5-send-traffic-to-your-instances>Task 5. Send traffic to your instances<a class=headerlink href=#task-5-send-traffic-to-your-instances title="Permanent link">&para;</a></h2> <p>Now that the load balancing service is configured, you can start sending traffic to the forwarding rule and watch the traffic be dispersed to different instances.</p> <ol> <li>Enter the following command to view the external IP address of the www-rule forwarding rule used by the load balancer:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>gcloud<span class=w> </span>compute<span class=w> </span>forwarding-rules<span class=w> </span>describe<span class=w> </span>www-rule<span class=w> </span>--region<span class=w> </span>Region
</span></code></pre></div> <ol> <li>Access the external IP address:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=nv>IPADDRESS</span><span class=o>=</span><span class=k>$(</span>gcloud<span class=w> </span>compute<span class=w> </span>forwarding-rules<span class=w> </span>describe<span class=w> </span>www-rule<span class=w> </span>--region<span class=w> </span>Region<span class=w> </span>--format<span class=o>=</span><span class=s2>&quot;json&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>-r<span class=w> </span>.IPAddress<span class=k>)</span>
</span></code></pre></div> <ol> <li>Show the external IP address:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=nb>echo</span><span class=w> </span><span class=nv>$IPADDRESS</span>
</span></code></pre></div> <ol> <li>Use the <code>curl</code> command to access the external IP address, replacing <code>IP_ADDRESS</code> with an external IP address from the previous command:</li> </ol> <div class="language-shell highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=k>while</span><span class=w> </span>true<span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>curl<span class=w> </span>-m1<span class=w> </span><span class=nv>$IPADDRESS</span><span class=p>;</span><span class=w> </span><span class=k>done</span>
</span></code></pre></div> <p>The response from the <code>curl</code> command alternates randomly among the three instances. If your response is initially unsuccessful, wait approximately 30 seconds for the configuration to be fully loaded and for your instances to be marked healthy before trying again.</p> <ol> <li>Use Ctrl + C to stop running the command.</li> </ol> <p>[gcloud-cli-overview-guide] : <a href=https://cloud.google.com/sdk/gcloud>https://cloud.google.com/sdk/gcloud</a> [gcp-regions-zones-doc] : <a href=https://cloud.google.com/compute/docs/zones>https://cloud.google.com/compute/docs/zones</a> [gcp-backend-service-based-external-passthrough-network-load-balancer-overview] : <a href=https://cloud.google.com/compute/docs/load-balancing/network/ >https://cloud.google.com/compute/docs/load-balancing/network/</a> [gcp-forwarding-rule] : <a href=https://cloud.google.com/load-balancing/docs/forwarding-rule-concepts>https://cloud.google.com/load-balancing/docs/forwarding-rule-concepts</a></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=.. class="md-footer__link md-footer__link--prev" aria-label="Previous: Home"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Home </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2016 - 2025 Martin Donath </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/squidfunk target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://hub.docker.com/r/squidfunk/mkdocs-material/ target=_blank rel=noopener title=hub.docker.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg> </a> <a href=https://pypi.org/project/mkdocs-material/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg> </a> <a href=https://bsky.app/profile/squidfunk.bsky.social target=_blank rel=noopener title=bsky.app class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M407.8 294.7c-3.3-.4-6.7-.8-10-1.3 3.4.4 6.7.9 10 1.3M288 227.1c-26.1-50.7-97.1-145.2-163.1-191.8C61.6-9.4 37.5-1.7 21.6 5.5 3.3 13.8 0 41.9 0 58.4S9.1 194 15 213.9c19.5 65.7 89.1 87.9 153.2 80.7 3.3-.5 6.6-.9 10-1.4-3.3.5-6.6 1-10 1.4-93.9 14-177.3 48.2-67.9 169.9C220.6 589.1 265.1 437.8 288 361.1c22.9 76.7 49.2 222.5 185.6 103.4 102.4-103.4 28.1-156-65.8-169.9-3.3-.4-6.7-.8-10-1.3 3.4.4 6.7.9 10 1.3 64.1 7.1 133.6-15.1 153.2-80.7C566.9 194 576 75 576 58.4s-3.3-44.7-21.6-52.9c-15.8-7.1-40-14.9-103.2 29.8C385.1 81.9 314.1 176.4 288 227.1"/></svg> </a> <a href=https://fosstodon.org/@squidfunk target=_blank rel="noopener me" title=fosstodon.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M433 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.6-28.4-290.5 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.6-.9-9.3-.9-13.9 85.6 20.9 158.7 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5H201V197c0-58.5-64-56.6-64-6.9v114.2H90.3c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175"/></svg> </a> <a href=https://x.com/squidfunk target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.e71a0d61.min.js></script> <script src=../assets/javascripts/custom.95054b18.min.js></script> </body> </html>